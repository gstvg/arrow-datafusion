# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

#   http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

##########
## UNION DataType Tests
##########

statement ok
CREATE external table dense_union_bigger_child STORED as ARROW LOCATION '../core/tests/data/dense_union_bigger_child.arrow';

statement ok
CREATE external table dense_union_empty_child STORED as ARROW LOCATION '../core/tests/data/dense_union_empty_child.arrow';

statement ok
CREATE external table dense_union_multiple_types STORED as ARROW LOCATION '../core/tests/data/dense_union_multiple_types.arrow';

statement ok
CREATE external table dense_union_single_type_exact_size STORED as ARROW LOCATION '../core/tests/data/dense_union_single_type_exact_size.arrow';

statement ok
CREATE external table sparse_union STORED as ARROW LOCATION '../core/tests/data/sparse_union.arrow';


query ?
select union_tag(my_union) from dense_union_bigger_child;
----
a

query I
select union_extract(my_union, 'a') from dense_union_bigger_child;
----
1




query ?
select union_tag(my_union) from dense_union_empty_child;
----
a

query I
select union_extract(my_union, 'a') from dense_union_empty_child;
----
1

query B
select union_extract(my_union, 'b') from dense_union_empty_child;
----
NULL





query ?
select union_tag(my_union) from dense_union_multiple_types;
----
a
b
a

query I
select union_extract(my_union, 'a') from dense_union_multiple_types;
----
1
NULL
4

query R
select union_extract(my_union, 'b') from dense_union_multiple_types;
----
NULL
3
NULL





query ?
select union_tag(my_union) from dense_union_single_type_exact_size;
----
a
a

query I
select union_extract(my_union, 'a') from dense_union_single_type_exact_size;
----
1
4






query ?
select union_tag(my_union) from sparse_union;
----
a
b
a

query I
select union_extract(my_union, 'a') from sparse_union;
----
1
NULL
4

query R
select union_extract(my_union, 'b') from sparse_union;
----
NULL
3
NULL



statement ok
DROP TABLE dense_union_bigger_child;

statement ok
DROP TABLE dense_union_empty_child;

statement ok
DROP TABLE dense_union_multiple_types;

statement ok
DROP TABLE dense_union_single_type_exact_size;

statement ok
DROP TABLE sparse_union;
